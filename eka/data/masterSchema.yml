---
# #Note: The document follows an extended version OF JSON-Schema Draft 4.
# #Pending: Add descriptions, where necessary.

$id: eka-v1.json # http://example.com/eka-v1.json
$schema: http://json-schema.org/draft-04/schema#
description: The master schema for Eka documents.
type: object

definitions:
  providable:
    providers:
      type: [string, array]

  expression: {}

  rest.app:
    allOf:
      - $ref: '#/definitions/providable'
      - type: object
        properties:
          class:
            # #Note: The key, const isn't available in draft 4.
            enum: [app]
            default: app
          props:
            type: object
            patternProperties:
              '^([A-z0-9_-])+$':
                anyOf:
                  - $ref: '#/definitions/rest.client'
                  - $ref: '#/definitions/rest.server'

  rest.client: # #Note: Nested definitions (like app/client) aren't used, as it complicates the schema.
    allOf:
      - $ref: '#/definitions/providable'
      - type: object
        properties:
          class:
            enum: [rest.client]
            default: rest.client
          buildBase:
            type: string
          uiRoot:
            type: string
          props:
            type: object
            patternProperties:
              '^([A-z0-9_-])+$':
                $ref: '#/definitions/rest.client.element'

  rest.client.element:
      allOf:
        - $ref: '#/definitions/providable'
        - type: object
          properties:
            class:
              enum: [rest.client.element]
              default: rest.client.element
            value:
              type: string
            props:
              patternProperties:
                '^([A-z0-9_-])+$':
                  anyOf:
                    - $ref: '#/definitions/rest.client.element'
                    - $ref: '#/definitions/rest.client.element.button'

  rest.client.element.button:
    allOf:
      - $ref: '#/definitions/providable'
      - type: object
        properties:
          title:
            type: string
          action:
            type: string
          class:
            enum: [rest.client.element.button]
            default: rest.client.element.button

  rest.server:
    allOf:
      - $ref: '#/definitions/providable'
      - type: object
        properties:
          class:
            enum: [rest.server]
            default: rest.server
          builder:
            type: string
          buildBase:
            type: string
          props:
            type: object
            patternProperties:
              '^([A-z0-9_-])+$':
                $ref: '#/definitions/rest.server.resource'

  rest.server.resource:
    allOf:
      - $ref: '#/definitions/providable'
      - type: object
        properties:
          class:
            enum: [rest.server.resource]
            default: rest.server.resource
          permissions:
            type: string
            default: crud
            pattern: '^[crud]+|all|none|$'
          props:
            type: object
            patternProperties:
              '^([A-z0-9_-])+$':
                $ref: '#/definitions/rest.server.resource.field'

  rest.server.resource.field:
      allOf:
        - $ref: '#/definitions/providable'
        - anyOf:
          - type: [integer, string]
          - type: object
            properties:
                class:
                  enum: [rest.server.resource.field]
                  default: rest.server.resource.field
                value:
                  type: [integer, string]

properties:
  props:
    type: object
    patternProperties:
      '^([A-z0-9_-])+$': {}
  class:
    enum: [master]
    default: master
